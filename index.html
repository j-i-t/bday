<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Message Board</title>
<style>
:root {
  --bg: #1c1c1e;
  --card: #2c2c2e;
  --border: #3a3a3c;
  --accent: #f2f2f2;
}
body {
  background: var(--bg);
  color: var(--accent);
  font-family: 'Inter', sans-serif;
  display: flex;
  justify-content: center;
  padding: 40px 20px;
  min-height: 100vh;
}
.container { max-width: 800px; width: 100%; }
.section { display: none; }
.section.active { display: block; }
input, textarea, button {
  width:100%; padding:12px; border-radius:8px; border:1px solid var(--border);
  font-size:1rem; margin-bottom:15px; background:#2c2c2e; color:var(--accent);
}
input:focus, textarea:focus { outline:none; border-color:var(--accent); }
textarea { min-height:80px; resize:vertical; }
button { cursor:pointer; border:none; font-weight:600; }
button:hover { opacity:0.85; }
#enterNameBtn,#submitMsgBtn,#nextPhotoBtn,#skipBtn,#finalSubmitBtn,#backToPhotoBtn,#adminBtn,#adminBtnPreview,#adminBtnThank {
  background: var(--accent); color: var(--bg); margin-top:5px;
}

/* Image Upload Buttons */
.photo-btn {
  display:flex; justify-content:center; align-items:center;
  border: 2px dashed var(--accent);
  background: transparent; color:var(--accent);
  font-size:1rem; border-radius:10px;
  height:200px; margin-bottom:15px; cursor:pointer; position:relative;
  overflow:hidden;
}
.photo-btn input { display:none; }
.photo-btn img {
  width:100%; height:100%; object-fit:cover;
  position:absolute; top:0; left:0; border-radius:10px;
}
.photo-btn span {
  font-size:2rem; z-index:2; position:relative;
  pointer-events:none;
  background:rgba(0,0,0,0.3); padding:5px 15px; border-radius:8px;
}

.preview-img {
  width:100%; max-height:400px; object-fit:cover; border-radius:10px; margin-bottom:10px;
  display:block; margin:auto;
}
.message-text-preview {
  background:#29292c; color:white; padding:10px; border-radius:6px; margin-top:10px;
  text-align:center;
}
.arrow {
  position: absolute; top:50%; transform:translateY(-50%);
  font-size:2rem; color:white;
  background: rgba(0,0,0,0.3); width:38px; height:38px; border-radius:50%;
  display:flex; justify-content:center; align-items:center; cursor:pointer; z-index:10;
}
.arrow:hover { background: rgba(0,0,0,0.5); }
.arrow-left { left:10px; }
.arrow-right { right:10px; }

.messages-layout {
  display: flex;
  gap: 20px;
  margin-top: 30px;
}
.name-list {
  width: 200px;
  background: var(--card);
  padding: 15px;
  border-radius: 10px;
  height: 80vh;
  overflow-y: auto;
}
.name-item {
  padding: 10px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}
.name-item:hover { background: rgba(255,255,255,0.1); }
.main-gallery {
  flex: 1;
  background: var(--card);
  border-radius: 10px;
  padding: 20px;
  overflow-y: auto;
  height: 80vh;
}
.preview-box {
  background: #2c2c2e;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  margin-bottom: 20px;
}
.preview-box img {
  width: 100%;
  border-radius: 10px;
  object-fit: cover;
  margin-bottom: 10px;
}
.preview-name {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 8px;
}
.delete-btn {
  background:#f44336; color:white; border:none; border-radius:6px;
  padding:5px 10px; cursor:pointer; margin-top:5px;
}
.delete-btn:hover { background:#d32f2f; }
</style>
</head>
<body>
<div class="container">
  <button id="adminBtn">Admin View</button>

  <!-- Step 1 -->
  <div id="nameSection" class="section active">
    <h1>Welcome!</h1>
    <p>Enter your name to continue:</p>
    <input type="text" id="userNameInput" placeholder="Your name">
    <button id="enterNameBtn">Next</button>
  </div>

  <!-- Step 2 -->
  <div id="messageSection" class="section">
    <h1>Leave a Message</h1>
    <textarea id="messageInput" placeholder="Your message..."></textarea>
    <button id="submitMsgBtn">Next</button>
  </div>

  <!-- Step 3 -->
  <div id="photoSection" class="section">
    <h1>Add Photos (max 3)</h1>
    <div id="photoButtons"></div>
    <button id="nextPhotoBtn">Preview</button>
    <button id="skipBtn">Skip</button>
  </div>

  <!-- Step 4 -->
  <div id="previewSection" class="section">
    <h1>Preview</h1>
    <div id="previewGallery" style="position:relative;"></div>
    <button id="finalSubmitBtn">Submit</button>
    <button id="backToPhotoBtn">Back</button>
    <button id="adminBtnPreview">Admin View</button>
  </div>

  <!-- Step 5 -->
  <div id="thankYouSection" class="section">
    <h1>Thanks for your message! ðŸŽ‰</h1>
    <p>Your message has been submitted successfully.</p>
    <button id="adminBtnThank">Admin View</button>
  </div>

  <!-- Admin -->
  <div id="adminSection" class="section">
    <div class="messages-layout">
      <div class="name-list" id="nameList"></div>
      <div class="main-gallery" id="adminGallery"></div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDFNxj9dXHwC3gZ__pxlPzVObaq3pYXsHU",
  authDomain: "message-board-11427.firebaseapp.com",
  databaseURL: "https://message-board-11427-default-rtdb.firebaseio.com/",
  projectId: "message-board-11427",
  storageBucket: "message-board-11427.appspot.com",
  messagingSenderId: "1025990128029",
  appId: "1:1025990128029:web:8fac79b3115d113b283f74"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userName="", userMessage="", userPhotos=[null,null,null], currentPreview=0;
const ADMIN_PASSCODE="8080";

// Step 1
document.getElementById("enterNameBtn").onclick = ()=>{
  const name=document.getElementById("userNameInput").value.trim();
  if(!name){alert("Enter name"); return;}
  userName=name;
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById("messageSection").classList.add("active");
};

// Step 2
document.getElementById("submitMsgBtn").onclick = ()=>{
  const msg=document.getElementById("messageInput").value.trim();
  if(!msg){alert("Enter message"); return;}
  userMessage=msg;
  setupPhotoButtons();
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById("photoSection").classList.add("active");
};

// Step 3: Photo buttons
function setupPhotoButtons(){
  const container = document.getElementById("photoButtons");
  container.innerHTML="";
  for(let i=0;i<3;i++){
    const btn = document.createElement("label");
    btn.className="photo-btn";
    btn.innerHTML=`<span>+ Add Image ${i+1}</span><input type="file" accept="image/*" data-index="${i}">`;
    container.appendChild(btn);
    const input = btn.querySelector("input");
    input.onchange = e=>{
      const file=e.target.files[0], index=e.target.dataset.index;
      if(file){
        const reader = new FileReader();
        reader.onload = ()=>{
          userPhotos[index]=reader.result;
          btn.innerHTML=`<img src="${reader.result}" alt="Photo ${parseInt(index)+1}"><input type="file" accept="image/*" data-index="${index}">`;
          btn.querySelector("input").onchange = input.onchange;
        };
        reader.readAsDataURL(file);
      }
    };
  }
}

// Step 3 â†’ 4
document.getElementById("nextPhotoBtn").onclick = document.getElementById("skipBtn").onclick = ()=>{
  showPreview();
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById("previewSection").classList.add("active");
};

// Preview
function showPreview(){
  const gallery = document.getElementById("previewGallery");
  gallery.innerHTML=`<h2 class="preview-name">From: ${userName}</h2>`;
  const images = userPhotos.filter(p=>p);
  if(images.length){
    const img=document.createElement("img"); img.src=images[currentPreview]; img.className="preview-img";
    gallery.appendChild(img);
    const msgDiv=document.createElement("div"); msgDiv.className="message-text-preview"; msgDiv.textContent=userMessage;
    gallery.appendChild(msgDiv);
    if(images.length>1){
      const left=document.createElement("button"); left.innerHTML="&#10094;"; left.className="arrow arrow-left";
      left.onclick=()=>{currentPreview=(currentPreview-1+images.length)%images.length; showPreview();};
      const right=document.createElement("button"); right.innerHTML="&#10095;"; right.className="arrow arrow-right";
      right.onclick=()=>{currentPreview=(currentPreview+1)%images.length; showPreview();};
      gallery.appendChild(left); gallery.appendChild(right);
    }
  } else {
    const msgDiv=document.createElement("div"); msgDiv.className="message-text-preview"; msgDiv.textContent=userMessage;
    gallery.appendChild(msgDiv);
  }
}

// Back
document.getElementById("backToPhotoBtn").onclick = ()=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById("photoSection").classList.add("active");
};

// Submit
document.getElementById("finalSubmitBtn").onclick = ()=>{
  db.ref("messages").push({
    name:userName,
    message:userMessage,
    photos:userPhotos.filter(p=>p),
    timestamp:new Date().toISOString()
  });
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById("thankYouSection").classList.add("active");
};

// Admin buttons
["adminBtn","adminBtnPreview","adminBtnThank"].forEach(id=>{
  document.getElementById(id).onclick = async ()=>{
    const code=prompt("Enter admin passcode:");
    if(code!==ADMIN_PASSCODE){alert("Incorrect"); return;}
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById("adminSection").classList.add("active");
    const snapshot = await db.ref("messages").once("value");
    const messages = snapshot.val()||{};
    const nameList=document.getElementById("nameList"), adminGallery=document.getElementById("adminGallery");
    nameList.innerHTML=""; adminGallery.innerHTML="<p>Select a name to view their message</p>";
    Object.entries(messages).forEach(([key,msg])=>{
      const item=document.createElement("div"); item.className="name-item"; item.textContent=msg.name;
      item.onclick=()=>{
        adminGallery.innerHTML=""; const box=document.createElement("div"); box.className="preview-box";
        box.innerHTML=`<div class="preview-name">From: ${msg.name}</div>`;
        if(msg.photos) msg.photos.forEach(p=>{ const img=document.createElement("img"); img.src=p; box.appendChild(img); });
        const text=document.createElement("div"); text.className="message-text-preview"; text.textContent=msg.message;
        box.appendChild(text);
        const del=document.createElement("button"); del.className="delete-btn"; del.textContent="Delete";
        del.onclick=async ()=>{
          if(confirm("Delete this message?")){
            await db.ref("messages/"+key).remove();
            item.remove(); adminGallery.innerHTML="<p>Deleted.</p>";
          }
        };
        box.appendChild(del); adminGallery.appendChild(box);
      };
      nameList.appendChild(item);
    });
  };
});
</script>
</body>
</html>
