<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Message Board</title>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" />
</head>
<body class="bg-gray-100 flex h-screen">

  <!-- Sidebar -->
  <aside class="w-1/4 bg-white shadow-md overflow-y-auto p-4">
    <h2 class="text-xl font-bold mb-3">Messages</h2>
    <ul id="userList" class="space-y-2"></ul>
    <button id="adminBtn" class="mt-5 w-full bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded">Admin View</button>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div id="inputSection">
      <h1 class="text-2xl font-bold mb-4">Welcome to the Message Board</h1>

      <div id="nameSection" class="space-y-3">
        <label class="block font-semibold">Enter your name:</label>
        <input type="text" id="nameInput" class="border rounded px-3 py-2 w-1/2" placeholder="Your name..." />
        <button id="nextBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Next</button>
      </div>

      <div id="messageSection" class="hidden space-y-3">
        <label class="block font-semibold">Enter your message:</label>
        <textarea id="messageInput" class="border rounded px-3 py-2 w-full h-24" placeholder="Your message..."></textarea>

        <label class="block font-semibold mt-2">Upload a photo:</label>
        <input type="file" id="photoInput" accept="image/*" class="border rounded px-2 py-1" />
        <img id="photoPreview" class="mt-2 hidden w-48 h-48 object-cover rounded shadow" />

        <button id="submitBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Submit</button>
      </div>
    </div>

    <div id="displaySection" class="hidden">
      <h2 class="text-xl font-bold mb-2">Message Details</h2>
      <p id="messageText" class="text-lg"></p>
      <img id="messagePhoto" class="mt-4 max-w-sm rounded-lg shadow hidden" />
      <button id="deleteBtn" class="mt-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded hidden">Delete</button>
    </div>

    <button id="exportBtn" class="mt-8 bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded hidden">Export All</button>
  </main>

  <script>
    // Firebase setup
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "message-board-11427.firebaseapp.com",
      databaseURL: "https://message-board-11427-default-rtdb.firebaseio.com/",
      projectId: "message-board-11427",
      storageBucket: "message-board-11427.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    const userList = document.getElementById("userList");
    const nameInput = document.getElementById("nameInput");
    const nextBtn = document.getElementById("nextBtn");
    const messageSection = document.getElementById("messageSection");
    const nameSection = document.getElementById("nameSection");
    const messageInput = document.getElementById("messageInput");
    const photoInput = document.getElementById("photoInput");
    const photoPreview = document.getElementById("photoPreview");
    const submitBtn = document.getElementById("submitBtn");
    const messageText = document.getElementById("messageText");
    const messagePhoto = document.getElementById("messagePhoto");
    const deleteBtn = document.getElementById("deleteBtn");
    const adminBtn = document.getElementById("adminBtn");
    const exportBtn = document.getElementById("exportBtn");

    let currentName = "";
    let isAdmin = false;

    nextBtn.onclick = () => {
      if (!nameInput.value.trim()) return alert("Enter your name first!");
      currentName = nameInput.value.trim();
      nameSection.classList.add("hidden");
      messageSection.classList.remove("hidden");
    };

    photoInput.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = evt => {
          photoPreview.src = evt.target.result;
          photoPreview.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    };

    submitBtn.onclick = async () => {
      const message = messageInput.value.trim();
      const file = photoInput.files[0];
      if (!message) return alert("Enter a message!");

      let photoURL = "";
      if (file) {
        const storageRef = storage.ref("photos/" + Date.now() + "_" + file.name);
        await storageRef.put(file);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.ref("messages").push({ name: currentName, message, photoURL });
      alert("Thanks for your message!");
      location.reload();
    };

    function renderMessages(snapshot) {
      userList.innerHTML = "";
      snapshot.forEach(child => {
        const data = child.val();
        const li = document.createElement("li");
        li.textContent = data.name;
        li.className = "cursor-pointer hover:bg-gray-200 px-3 py-1 rounded";
        li.onclick = () => {
          messageText.textContent = data.message;
          if (data.photoURL) {
            messagePhoto.src = data.photoURL;
            messagePhoto.classList.remove("hidden");
          } else {
            messagePhoto.classList.add("hidden");
          }
          deleteBtn.dataset.key = child.key;
          deleteBtn.classList.toggle("hidden", !isAdmin);
        };
        userList.appendChild(li);
      });
    }

    db.ref("messages").on("value", renderMessages);

    adminBtn.onclick = () => {
      const key = prompt("Enter admin key:");
      if (key === "1234") { // change this key
        isAdmin = true;
        alert("Admin access granted");
        exportBtn.classList.remove("hidden");
      } else {
        alert("Wrong key!");
      }
    };

    deleteBtn.onclick = async () => {
      const key = deleteBtn.dataset.key;
      if (confirm("Delete this message?")) {
        await db.ref("messages/" + key).remove();
        alert("Deleted!");
        location.reload();
      }
    };

    exportBtn.onclick = async () => {
      const snapshot = await db.ref("messages").get();
      const data = snapshot.val();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "messages.json";
      a.click();
    };
  </script>
</body>
</html>
