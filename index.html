<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Message Board</title>
<style>
:root {
  --bg: #f5f5f5;
  --card: #fff;
  --accent: #6b7aff;
  --text: #333;
  --muted: #555;
  --btn-bg: #6b7aff;
  --btn-hover: #5661d2;
}
body {
  background: var(--bg);
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  padding: 40px 20px;
  min-height: 100vh;
  color: var(--text);
}
.container {
  background: var(--card);
  border-radius: 12px;
  padding: 30px;
  max-width: 700px;
  width: 100%;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align:center;
}
h1 { margin-bottom:15px; }
p { color:var(--muted); margin-bottom:20px; }
input, textarea, button { width:100%; padding:12px; border-radius:8px; border:1px solid #ccc; margin-bottom:15px; font-size:1rem; }
input:focus, textarea:focus { outline:none; border-color:var(--accent); }
textarea { resize:vertical; min-height:80px; }
button { background: var(--btn-bg); color:white; border:none; cursor:pointer; transition:0.2s; }
button:hover { background: var(--btn-hover); }
.section { display:none; }
.section.active { display:block; }
.photo-preview img { max-width:100px; max-height:100px; margin:5px; border-radius:6px; border:1px solid #ccc; }
.slideshow-container { position:relative; margin-top:15px; }
.slide { display:none; border:1px solid #ccc; border-radius:8px; padding:10px; background:#f0f0f0; }
.slide img { max-width:100%; border-radius:6px; }
.nav-btn { background:var(--btn-bg); color:white; border:none; padding:10px 15px; border-radius:6px; cursor:pointer; margin:5px; }
.nav-btn:hover { background:var(--btn-hover); }
.message-preview { background:#eaeaea; padding:10px; border-radius:6px; margin-top:10px; white-space:pre-wrap; text-align:left; }
.admin-section { margin-top:20px; text-align:left; }
.admin-message { border-bottom:1px solid #ccc; padding:10px 0; }
.delete-btn { background:#f44336; color:white; border:none; padding:5px 10px; border-radius:6px; cursor:pointer; }
.delete-btn:hover { background:#d32f2f; }
</style>
</head>
<body>
<div class="container">

  <!-- Step 1: Name -->
  <div id="nameSection" class="section active">
    <h1>Birthday Message ðŸŽ‰</h1>
    <p>Enter your name to continue:</p>
    <input type="text" id="userNameInput" placeholder="Your name" />
    <button id="enterNameBtn">Next</button>
  </div>

  <!-- Step 2: Message -->
  <div id="messageSection" class="section">
    <h1>Write Your Message</h1>
    <textarea id="messageInput" placeholder="Your message..."></textarea>
    <button id="nextToPhotoBtn">Next</button>
    <button id="backToNameBtn">Back</button>
  </div>

  <!-- Step 3: Photo Upload -->
  <div id="photoSection" class="section">
    <h1>Add Photos (optional, max 3)</h1>
    <label style="cursor:pointer; background: var(--btn-bg); color:white; padding:10px; border-radius:8px; display:inline-block;">
      Select Photos
      <input type="file" id="photoInput" accept="image/*" multiple style="display:none;">
    </label>
    <div class="photo-preview" id="photoPreview"></div>
    <button id="nextToPreviewBtn">Preview</button>
    <button id="backToMessageBtn">Back</button>
  </div>

  <!-- Step 4: Preview -->
  <div id="previewSection" class="section">
    <h1>Preview Your Message</h1>
    <div id="previewName"></div>
    <div class="message-preview" id="previewMessage"></div>
    <div class="slideshow-container" id="previewSlideshow"></div>
    <button id="submitBtn">Submit</button>
    <button id="backToPhotoBtn">Back</button>
  </div>

  <!-- Step 5: Thank You -->
  <div id="thankYouSection" class="section">
    <h1>Thanks! ðŸŽ‰</h1>
    <p>Your birthday message has been sent.</p>
  </div>

  <!-- Admin Section -->
  <div id="adminSection" class="section admin-section">
    <h1>Admin View</h1>
    <button id="backToStartAdminBtn">Back to Start</button>
    <div id="adminMessages"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, get, remove, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDFNxj9dXHwC3gZ__pxlPzVObaq3pYXsHU",
  authDomain: "message-board-11427.firebaseapp.com",
  databaseURL: "https://message-board-11427-default-rtdb.firebaseio.com/",
  projectId: "message-board-11427",
  storageBucket: "message-board-11427.appspot.com",
  messagingSenderId: "1025990128029",
  appId: "1:1025990128029:web:8fac79b3115d113b283f74"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userName = "";
let messageText = "";
let photoFiles = [];
let currentSlide = 0;
const ADMIN_PASSCODE = "8080";

// --- Step Navigation ---
function showSection(sectionId){
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById(sectionId).classList.add("active");
}

// Step1
document.getElementById("enterNameBtn").addEventListener("click", ()=>{
  const val = document.getElementById("userNameInput").value.trim();
  if(!val) return alert("Please enter your name");
  userName = val;
  showSection("messageSection");
});

// Step2
document.getElementById("nextToPhotoBtn").addEventListener("click", ()=>{
  const val = document.getElementById("messageInput").value.trim();
  if(!val) return alert("Please enter a message");
  messageText = val;
  showSection("photoSection");
});
document.getElementById("backToNameBtn").addEventListener("click", ()=>showSection("nameSection"));

// Step3
const photoInput = document.getElementById("photoInput");
const photoPreview = document.getElementById("photoPreview");

photoInput.addEventListener("change", ()=>{
  photoFiles = Array.from(photoInput.files).slice(0,3);
  photoPreview.innerHTML = "";
  photoFiles.forEach(f=>{
    const img = document.createElement("img");
    img.src = URL.createObjectURL(f);
    photoPreview.appendChild(img);
  });
});

document.getElementById("nextToPreviewBtn").addEventListener("click", ()=>{
  // Fill preview
  document.getElementById("previewName").textContent = `From ${userName}`;
  document.getElementById("previewMessage").textContent = messageText;

  const slideshow = document.getElementById("previewSlideshow");
  slideshow.innerHTML = "";
  if(photoFiles.length === 0){
    slideshow.textContent = "No photos added";
  } else {
    photoFiles.forEach((file,i)=>{
      const div = document.createElement("div");
      div.className="slide";
      if(i===0) div.style.display="block";
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      div.appendChild(img);
      slideshow.appendChild(div);
    });
    if(photoFiles.length>1){
      const prev = document.createElement("button");
      prev.textContent="<";
      prev.className="nav-btn";
      prev.onclick=()=>showSlide(-1);
      const next = document.createElement("button");
      next.textContent=">";
      next.className="nav-btn";
      next.onclick=()=>showSlide(1);
      slideshow.appendChild(prev);
      slideshow.appendChild(next);
    }
    currentSlide = 0;
  }

  showSection("previewSection");
});

document.getElementById("backToMessageBtn").addEventListener("click", ()=>showSection("messageSection"));
document.getElementById("backToPhotoBtn").addEventListener("click", ()=>showSection("photoSection"));

// Slideshow navigation
function showSlide(direction){
  const slides = document.querySelectorAll("#previewSlideshow .slide");
  slides[currentSlide].style.display="none";
  currentSlide=(currentSlide+direction+slides.length)%slides.length;
  slides[currentSlide].style.display="block";
}

// Step4: Submit
document.getElementById("submitBtn").addEventListener("click", async ()=>{
  const readerPromises = photoFiles.map(f=>new Promise(res=>{
    const fr = new FileReader();
    fr.onload = ()=>res(fr.result);
    fr.readAsDataURL(f);
  }));
  const photoData = await Promise.all(readerPromises);

  await push(ref(db,"messages"),{
    name: userName,
    message: messageText,
    photos: photoData,
    timestamp: new Date().toISOString()
  });

  showSection("thankYouSection");
});

// Admin
function loadAdmin(){
  const code = prompt("Enter admin passcode:");
  if(code!==ADMIN_PASSCODE) return alert("Incorrect passcode!");
  const adminDiv = document.getElementById("adminMessages");
  adminDiv.innerHTML = "";
  get(ref(db,"messages")).then(snapshot=>{
    const msgs = snapshot.exists()? snapshot.val() : {};
    if(Object.keys(msgs).length===0){
      adminDiv.innerHTML="<p>Nothing here.</p>";
    }
    Object.entries(msgs).sort((a,b)=>new Date(b[1].timestamp)-new Date(a[1].timestamp))
      .forEach(([key,msg])=>{
        const div = document.createElement("div");
        div.className="admin-message";
        const photosHTML = msg.photos?.map(p=>`<img src="${p}" style="max-width:80px; margin:5px; border-radius:4px;">`).join("")||"";
        div.innerHTML=`<strong>From ${
