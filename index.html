<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Birthday Message Board</title>
<style>
:root{
  --bg:#1c1c1e;
  --card:#2c2c2e;
  --border:#3a3a3c;
  --accent:#f2f2f2;
  --muted:#a0a0a0;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--accent);
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  display:flex;
  justify-content:center;
  padding:28px;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* container */
.container{
  width:100%;
  max-width:800px;
}

/* sections */
.section{display:none}
.section.active{display:block}

/* inputs/buttons */
input,textarea,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#2c2c2e;
  color:var(--accent);
  font-size:15px;
  margin-bottom:14px;
}
input:focus,textarea:focus{outline:none;border-color:var(--accent)}
textarea{min-height:88px;resize:vertical}

/* primary button look */
.btn-primary{
  background:var(--accent);
  color:var(--bg);
  font-weight:700;
  border:none;
}
.btn-ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  color:var(--accent);
}

/* image upload placeholder */
.photo-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  height:200px;
  border-radius:10px;
  border:2px dashed rgba(242,242,242,0.18);
  color:var(--accent);
  background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  cursor:pointer;
  overflow:hidden;
  position:relative;
}
.photo-btn input{display:none}
.photo-btn img{
  width:100%;
  height:100%;
  object-fit:cover;
  position:absolute;
  top:0;left:0;
  border-radius:10px;
}

/* preview */
.preview-img{
  width:100%;
  max-height:420px;
  object-fit:cover;
  border-radius:10px;
  display:block;
  margin:8px 0;
}
.message-text-preview{
  background:#29292c;
  color:#fff;
  padding:12px;
  border-radius:8px;
  text-align:center;
}

/* arrows - default desktop outside image */
.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:46px;
  height:46px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.45);
  color:#fff;
  font-size:22px;
  cursor:pointer;
  z-index:4;
}
.arrow-left{left:-62px}
.arrow-right{right:-62px}

/* admin layout */
.messages-layout{
  display:flex;
  gap:20px;
  margin-top:24px;
}
.name-list{
  width:220px;
  background:var(--card);
  padding:12px;
  border-radius:10px;
  height:72vh;
  overflow:auto;
}
.name-item{
  padding:10px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
}
.name-item:hover{background:rgba(255,255,255,0.04)}
.main-gallery{
  flex:1;
  background:var(--card);
  border-radius:10px;
  padding:18px;
  height:72vh;
  overflow:auto;
}
.preview-box{
  background:#2c2c2e;
  border-radius:12px;
  padding:16px;
  text-align:center;
  margin-bottom:14px;
}
.preview-box img{width:100%;border-radius:8px;object-fit:cover;margin-bottom:10px}
.preview-name{font-weight:700;margin-bottom:8px}

/* responsive adjustments */
@media (max-width:900px){
  .arrow-left{left:6px}
  .arrow-right{right:6px}
}
@media (max-width:640px){
  body{padding:18px}
  .photo-btn{height:150px}
  .preview-img{max-height:260px}
  .messages-layout{flex-direction:column}
  .name-list{width:100%;height:auto;max-height:200px}
  .main-gallery{height:auto;max-height:60vh}
  /* make arrows sit slightly inside the image on small screens */
  .arrow-left{left:6px}
  .arrow-right{right:6px}
}
</style>
</head>
<body>
<div class="container">
  <!-- top admin button -->
  <div style="display:flex;justify-content:flex-end;margin-bottom:12px">
    <button id="adminBtn" class="btn-ghost" style="max-width:140px">Admin View</button>
  </div>

  <!-- Step 1: name -->
  <div id="nameSection" class="section active">
    <h2 style="margin:6px 0 10px">Welcome!</h2>
    <p style="color:var(--muted);margin-top:0">Enter your name to continue</p>
    <input id="userNameInput" placeholder="Your name" autocomplete="name" />
    <button id="enterNameBtn" class="btn-primary">Next</button>
  </div>

  <!-- Step 2: message -->
  <div id="messageSection" class="section">
    <h2 style="margin:6px 0 10px">Leave a Message</h2>
    <textarea id="messageInput" placeholder="Write your message..."></textarea>
    <button id="submitMsgBtn" class="btn-primary">Next</button>
  </div>

  <!-- Step 3: photos -->
  <div id="photoSection" class="section">
    <h2 style="margin:6px 0 10px">Add Photos (max 3)</h2>
    <div id="photoButtons" style="display:grid;grid-template-columns:repeat(1,1fr);gap:12px"></div>
    <div style="display:flex;gap:8px">
      <button id="nextPhotoBtn" class="btn-primary" style="flex:1">Preview</button>
      <button id="skipBtn" class="btn-ghost" style="flex:1">Skip</button>
    </div>
  </div>

  <!-- Step 4: preview -->
  <div id="previewSection" class="section">
    <h2 style="margin:6px 0 10px">Preview</h2>
    <div id="previewGallery" style="position:relative"></div>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="finalSubmitBtn" class="btn-primary" style="flex:1">Submit</button>
      <button id="backToPhotoBtn" class="btn-ghost" style="flex:1">Back</button>
    </div>

    <div style="margin-top:10px;display:flex;justify-content:flex-end">
      <button id="adminBtnPreview" class="btn-ghost" style="max-width:140px">Admin View</button>
    </div>
  </div>

  <!-- Step 5: thank you -->
  <div id="thankYouSection" class="section">
    <h1>Thanks for your message! ðŸŽ‰</h1>
    <p>Your message has been submitted successfully.</p>
    <button id="adminBtn">Admin View</button>
  </div>

  <!-- Admin view -->
  <div id="adminSection" class="section">
    <div class="messages-layout">
      <div class="name-list" id="nameList"></div>
      <div class="main-gallery" id="adminGallery">
        <p style="color:var(--muted)">Select a name to view their submission.</p>
      </div>
    </div>
  </div>
</div>

<!-- Firebase compat (loaded before main script) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
/* final JS (responsive + GitHub Pages friendly) */
(function(){
  const firebaseConfig = {
    apiKey: "AIzaSyDFNxj9dXHwC3gZ__pxlPzVObaq3pYXsHU",
    authDomain: "message-board-11427.firebaseapp.com",
    databaseURL: "https://message-board-11427-default-rtdb.firebaseio.com/",
    projectId: "message-board-11427",
    storageBucket: "message-board-11427.appspot.com",
    messagingSenderId: "1025990128029",
    appId: "1:1025990128029:web:8fac79b3115d113b283f74"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // state
  let userName = "";
  let userMessage = "";
  let userPhotos = [null,null,null];
  let currentPreview = 0;
  const ADMIN_PASSCODE = "8080";

  // helpers
  const $ = id => document.getElementById(id);
  const showSection = (id) => {
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    $(id).classList.add("active");
  };

  // Step 1
  $("enterNameBtn").addEventListener("click", ()=>{
    const name = $("userNameInput").value.trim();
    if(!name) return alert("Enter name");
    userName = name;
    showSection("messageSection");
  });

  // allow Enter on name input
  $("userNameInput").addEventListener("keydown", e=>{
    if(e.key === "Enter") $("enterNameBtn").click();
  });

  // Step 2
  $("submitMsgBtn").addEventListener("click", ()=>{
    const msg = $("messageInput").value.trim();
    if(!msg) return alert("Enter message");
    userMessage = msg;
    setupPhotoButtons();
    showSection("photoSection");
  });

  // Step 3: photo buttons (create and attach listeners)
  function setupPhotoButtons(){
    const container = $("photoButtons");
    container.innerHTML = "";
    // single column on mobile, two on wider screens - keep grid dynamic via CSS fallback
    for(let i=0;i<3;i++){
      const label = document.createElement("label");
      label.className = "photo-btn";
      label.innerHTML = `<span>+ Add Image ${i+1}</span><input type="file" accept="image/*" data-index="${i}">`;
      container.appendChild(label);

      const input = label.querySelector("input");
      input.addEventListener("change", (e)=>{
        const f = e.target.files[0];
        const idx = e.target.dataset.index;
        if(!f) return;
        const reader = new FileReader();
        reader.onload = ()=> {
          userPhotos[idx] = reader.result;
          // keep the input attached after replacing markup
          label.innerHTML = `<img src="${reader.result}" alt="Photo ${parseInt(idx)+1}"><input type="file" accept="image/*" data-index="${idx}">`;
          const newInput = label.querySelector("input");
          newInput.addEventListener("change", input.onchange || (ev=>{}));
        };
        reader.readAsDataURL(f);
      });
    }
  }

  // Next / Skip -> preview
  const toPreview = ()=>{
    currentPreview = 0;
    showPreview();
    showSection("previewSection");
    // scroll preview to top on small screens
    window.scrollTo({top:0,behavior:"smooth"});
  };
  $("nextPhotoBtn").addEventListener("click", toPreview);
  $("skipBtn").addEventListener("click", toPreview);

  // show preview with arrows outside image on desktop and inside a bit on mobile
  function showPreview(){
    const gallery = $("previewGallery");
    gallery.innerHTML = `<h3 class="preview-name">From: ${escapeHtml(userName)}</h3>`;
    const imgs = userPhotos.filter(p=>p);
    if(imgs.length){
      const wrapper = document.createElement("div");
      wrapper.style.position = "relative";
      // image element
      const imgEl = document.createElement("img");
      imgEl.className = "preview-img";
      imgEl.src = imgs[currentPreview];
      wrapper.appendChild(imgEl);

      // left/right arrows if needed
      if(imgs.length > 1){
        const left = document.createElement("button");
        left.className = "arrow arrow-left";
        left.innerHTML = "&#10094;";
        left.addEventListener("click", ()=>{
          currentPreview = (currentPreview - 1 + imgs.length) % imgs.length;
          showPreview();
        });
        const right = document.createElement("button");
        right.className = "arrow arrow-right";
        right.innerHTML = "&#10095;";
        right.addEventListener("click", ()=>{
          currentPreview = (currentPreview + 1) % imgs.length;
          showPreview();
        });
        wrapper.appendChild(left);
        wrapper.appendChild(right);
      }

      gallery.appendChild(wrapper);

      const msgDiv = document.createElement("div");
      msgDiv.className = "message-text-preview";
      msgDiv.textContent = userMessage;
      gallery.appendChild(msgDiv);
    } else {
      const msgDiv = document.createElement("div");
      msgDiv.className = "message-text-preview";
      msgDiv.textContent = userMessage;
      gallery.appendChild(msgDiv);
    }
  }

  // Back to photo selection
  $("backToPhotoBtn").addEventListener("click", ()=>{
    showSection("photoSection");
    window.scrollTo({top:0,behavior:"smooth"});
  });

  // Final submit
  $("finalSubmitBtn").addEventListener("click", async ()=>{
    const record = {
      name: userName,
      message: userMessage,
      photos: userPhotos.filter(p=>p),
      timestamp: new Date().toISOString()
    };
    try{
      await db.ref("messages").push(record);
    }catch(err){
      console.error("Firebase push error", err);
      alert("Failed to submit. Check console.");
      return;
    }
    // clear local state so same browser can send again if they want
    userName=""; userMessage=""; userPhotos=[null,null,null]; currentPreview=0;
    $("userNameInput").value=""; $("messageInput").value="";
    showSection("thankYouSection");
    window.scrollTo({top:0,behavior:"smooth"});
  });

  // Admin open function (shared by multiple buttons)
  async function openAdmin(){
    const code = prompt("Enter admin passcode:");
    if(code !== ADMIN_PASSCODE){ alert("Incorrect"); return; }
    showSection("adminSection");
    // fetch messages
    let snapshot;
    try{
      snapshot = await db.ref("messages").once("value");
    }catch(err){
      console.error("Firebase read error",err);
      alert("Failed to load messages. Check console.");
      return;
    }
    const messages = snapshot.val() || {};
    const nameList = $("nameList");
    const adminGallery = $("adminGallery");
    nameList.innerHTML = "";
    adminGallery.innerHTML = "<p style='color:var(--muted)'>Select a name to view their message</p>";

    // sort by timestamp descending so latest first
    const entries = Object.entries(messages).sort((a,b)=>{
      const ta = a[1].timestamp || "";
      const tb = b[1].timestamp || "";
      return tb.localeCompare(ta);
    });

    entries.forEach(([key,msg])=>{
      const item = document.createElement("div");
      item.className = "name-item";
      item.textContent = msg.name || "Anonymous";
      item.addEventListener("click", ()=>{
        adminGallery.innerHTML = "";
        const box = document.createElement("div");
        box.className = "preview-box";
        const nameEl = document.createElement("div");
        nameEl.className = "preview-name";
        nameEl.textContent = `From: ${msg.name || "Anonymous"}`;
        box.appendChild(nameEl);

        // photos (show as in preview; respect container size)
        if(Array.isArray(msg.photos) && msg.photos.length){
          msg.photos.forEach(src=>{
            const im = document.createElement("img");
            im.src = src;
            box.appendChild(im);
          });
        }

        const text = document.createElement("div");
        text.className = "message-text-preview";
        text.textContent = msg.message || "";
        box.appendChild(text);

        const del = document.createElement("button");
        del.className = "delete-btn";
        del.textContent = "Delete";
        del.addEventListener("click", async ()=>{
          if(!confirm("Delete this message?")) return;
          try{
            await db.ref("messages/"+key).remove();
            item.remove();
            adminGallery.innerHTML = "<p style='color:var(--muted)'>Deleted.</p>";
          }catch(err){
            console.error("Delete error",err);
            alert("Failed to delete. See console.");
          }
        });
        box.appendChild(del);
        adminGallery.appendChild(box);
      });
      nameList.appendChild(item);
    });

    // if there are entries, auto-click the first so admin sees content immediately
    if(nameList.firstChild){
      nameList.firstChild.click();
    }
  }

  // wire admin buttons
  ["adminBtn","adminBtnPreview"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener("click", openAdmin);
  });

  // ensure layout grid for photo buttons uses 2 columns on larger screens
  function applyResponsivePhotoGrid(){
    const pb = $("photoButtons");
    if(!pb) return;
    if(window.innerWidth > 640){
      pb.style.gridTemplateColumns = "repeat(2, 1fr)";
    }else{
      pb.style.gridTemplateColumns = "repeat(1, 1fr)";
    }
  }
  window.addEventListener("resize", applyResponsivePhotoGrid);
  applyResponsivePhotoGrid();

  // small accessibility: allow Enter in message to go to next
  $("messageInput").addEventListener("keydown", e=>{
    if(e.key === "Enter" && !e.shiftKey){ e.preventDefault(); $("submitMsgBtn").click(); }
  });

  // escape html helper
  function escapeHtml(s){
    if(!s) return "";
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    })[m]);
  }

})();
</script>
</body>
</html>

