<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Message Board</title>
<style>
:root {
  --bg: #1c1c1e;
  --card: #2c2c2e;
  --border: #3a3a3c;
  --accent: #f2f2f2;
}
body {
  background: var(--bg);
  color: var(--accent);
  font-family: 'Inter', sans-serif;
  display: flex;
  justify-content: center;
  padding: 40px 20px;
  min-height: 100vh;
}
.container { max-width: 800px; width: 100%; position: relative; }
.section { display: none; }
.section.active { display: block; }

input, textarea, button {
  width:100%; padding:12px; border-radius:8px; border:1px solid var(--border);
  font-size:1rem; margin-bottom:15px; background:#2c2c2e; color:var(--accent);
}
input:focus, textarea:focus { outline:none; border-color:var(--accent); }
textarea { min-height:80px; resize:vertical; }
button { cursor:pointer; border:none; font-weight:600; }
button:hover { opacity:0.85; }
#enterNameBtn, #submitMsgBtn, #nextPhotoBtn, #finalSubmitBtn, #backToPhotoBtn, #skipBtn, #adminBtn, #backBtn { 
  background: var(--accent); color: var(--bg); margin-top:5px; 
}

/* Image Upload */
.photo-btn {
  display:flex; justify-content:center; align-items:center;
  border: 2px dashed var(--accent);
  background: transparent; color:var(--accent);
  font-size:1rem; border-radius:10px;
  height:200px; margin-bottom:15px; cursor:pointer; position:relative;
  overflow:hidden;
}
.photo-btn input { display:none; }
.photo-btn img {
  width:100%; height:100%; object-fit:cover;
  position:absolute; top:0; left:0; border-radius:10px;
}
.photo-btn span {
  font-size:2rem; z-index:2; position:relative;
  pointer-events:none;
  background:rgba(0,0,0,0.3); padding:5px 15px; border-radius:8px;
}

/* Preview */
.preview-img {
  width:100%; max-height:400px; object-fit:cover; border-radius:10px; margin-bottom:10px;
  display:block; margin:auto;
}
.message-text-preview {
  background:#29292c; color:white; padding:10px; border-radius:6px; margin-top:10px;
  text-align:center;
}
.arrow {
  position: absolute; top:50%; transform:translateY(-50%);
  font-size:2rem; color:white;
  background: rgba(0,0,0,0.3); width:38px; height:38px; border-radius:50%;
  display:flex; justify-content:center; align-items:center; cursor:pointer; z-index:10;
}
.arrow:hover { background: rgba(0,0,0,0.5); }
.arrow-left { left:10px; }
.arrow-right { right:10px; }

/* Admin */
.admin-gallery {
  position: relative;
  background: var(--card);
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  overflow: hidden;
  min-height: 60vh;
}
.preview-box {
  background: #2c2c2e;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
}
.preview-box img {
  width: 100%;
  border-radius: 10px;
  object-fit: cover;
  margin-bottom: 10px;
}
.preview-name {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 8px;
}
.delete-btn {
  background:#f44336;
  color:white;
  border:none;
  border-radius:6px;
  padding:5px 10px;
  cursor:pointer;
  margin-top:5px;
}
.delete-btn:hover { background:#d32f2f; }

/* Timestamp */
.timestamp {
  font-size: 0.85rem;
  opacity: 0.7;
  margin-top: 6px;
  text-align: center;
}

/* Responsive */
@media (max-width: 768px) {
  .container { width: 100%; }
  .photo-btn { height: 150px; }
  .preview-img { max-height: 300px; }
}
</style>
</head>
<body>
<div class="container">
  <!-- Admin Button -->
  <button id="adminBtn">Admin View</button>

  <!-- Step 1 -->
  <div id="nameSection" class="section active">
    <h1>Welcome!</h1>
    <p>Enter your name to continue:</p>
    <input type="text" id="userNameInput" placeholder="Your name">
    <button id="enterNameBtn">Next</button>
  </div>

  <!-- Step 2 -->
  <div id="messageSection" class="section">
    <h1>Leave a Message!</h1>
    <textarea id="messageInput" placeholder="Your message..."></textarea>
    <button id="submitMsgBtn">Next</button>
  </div>

  <!-- Step 3 -->
  <div id="photoSection" class="section">
    <h1>Add Photos (max 3)</h1>
    <div id="photoButtons"></div>
    <button id="nextPhotoBtn">Preview</button>
    <button id="skipBtn">Skip</button>
  </div>

  <!-- Step 4 -->
  <div id="previewSection" class="section">
    <h1>Preview</h1>
    <div id="previewGallery" style="position:relative;"></div>
    <button id="finalSubmitBtn">Submit</button>
    <button id="backToPhotoBtn">Back</button>
  </div>

  <!-- Step 5 -->
  <div id="thankYouSection" class="section">
    <h1>Thanks for your message! ðŸŽ‰</h1>
    <p>Your message has been submitted successfully.</p>
  </div>

  <!-- Admin Page -->
  <div id="adminSection" class="section">
    <div class="admin-gallery" id="adminGallery">
      <h2>Loading...</h2>
    </div>
    <span class="arrow arrow-left" id="adminLeft">&#10094;</span>
    <span class="arrow arrow-right" id="adminRight">&#10095;</span>
    <button id="backBtn">Back</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDFNxj9dXHwC3gZ__pxlPzVObaq3pYXsHU",
  authDomain: "message-board-11427.firebaseapp.com",
  databaseURL: "https://message-board-11427-default-rtdb.firebaseio.com/",
  projectId: "message-board-11427",
  storageBucket: "message-board-11427.appspot.com",
  messagingSenderId: "1025990128029",
  appId: "1:1025990128029:web:8fac79b3115d113b283f74"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userName = "", userMessage = "", userPhotos = [null,null,null];
let currentPreview = 0;
let messagesArray = [];
let currentMessageIndex = 0;
const ADMIN_PASSCODE = "8080";

// Navigation helpers
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// Step 1
document.getElementById("enterNameBtn").onclick=()=>{
  const n=document.getElementById("userNameInput").value.trim();
  if(!n) return alert("Enter name");
  userName=n; showSection("messageSection");
};

// Step 2
document.getElementById("submitMsgBtn").onclick=()=>{
  const m=document.getElementById("messageInput").value.trim();
  if(!m) return alert("Enter message");
  userMessage=m;
  setupPhotoButtons();
  showSection("photoSection");
};

// Step 3
function setupPhotoButtons(){
  const cont=document.getElementById("photoButtons");
  cont.innerHTML="";
  for(let i=0;i<3;i++){
    const lbl=document.createElement("label");
    lbl.className="photo-btn";
    lbl.innerHTML=`<span>+ Add Image ${i+1}</span><input type="file" accept="image/*" data-index="${i}">`;
    cont.appendChild(lbl);
  }
  document.querySelectorAll(".photo-btn input").forEach(inp=>{
    inp.onchange=e=>{
      const file=e.target.files[0];
      const idx=e.target.dataset.index;
      if(file){
        const r=new FileReader();
        r.onload=()=>{
          userPhotos[idx]=r.result;
          const l=e.target.parentElement;
          l.innerHTML=`<img src="${r.result}"><input type="file" accept="image/*" data-index="${idx}">`;
          l.querySelector("input").onchange=inp.onchange;
        };
        r.readAsDataURL(file);
      }
    };
  });
}
document.getElementById("nextPhotoBtn").onclick=
document.getElementById("skipBtn").onclick=()=>{
  showPreview(); showSection("previewSection");
};

// Preview
function showPreview(){
  const g=document.getElementById("previewGallery");
  g.innerHTML="";
  const imgs=userPhotos.filter(p=>p);
  g.innerHTML=`<h2 class="preview-name">From: ${userName}</h2>`;
  if(imgs.length){
    const im=document.createElement("img");
    im.src=imgs[currentPreview];
    im.className="preview-img";
    g.appendChild(im);
    const msg=document.createElement("div");
    msg.className="message-text-preview";
    msg.textContent=userMessage;
    g.appendChild(msg);
    if(imgs.length>1){
      const L=document.createElement("span");L.className="arrow arrow-left";L.innerHTML="&#10094;";
      const R=document.createElement("span");R.className="arrow arrow-right";R.innerHTML="&#10095;";
      L.onclick=()=>{currentPreview=(currentPreview-1+imgs.length)%imgs.length;showPreview();};
      R.onclick=()=>{currentPreview=(currentPreview+1)%imgs.length;showPreview();};
      g.appendChild(L);g.appendChild(R);
    }
  } else {
    const msg=document.createElement("div");
    msg.className="message-text-preview";msg.textContent=userMessage;
    g.appendChild(msg);
  }
}
document.getElementById("backToPhotoBtn").onclick=()=>showSection("photoSection");

// Submit
document.getElementById("finalSubmitBtn").onclick=()=>{
  db.ref("messages").push({
    name:userName,message:userMessage,
    photos:userPhotos.filter(p=>p),
    timestamp:new Date().toISOString()
  });
  showSection("thankYouSection");
};

// Admin
document.getElementById("adminBtn").onclick=async()=>{
  const code=prompt("Enter admin passcode:");
  if(code!==ADMIN_PASSCODE) return alert("Incorrect");
  const snap=await db.ref("messages").once("value");
  const data=snap.val()||{};
  messagesArray=Object.entries(data);
  currentMessageIndex=0;
  showAdminMessage();
  showSection("adminSection");
};

function showAdminMessage(){
  const g=document.getElementById("adminGallery");
  if(messagesArray.length===0){g.innerHTML="<p>No messages yet.</p>";return;}
  const [key,msg]=messagesArray[currentMessageIndex];
  g.innerHTML="";
  const box=document.createElement("div");box.className="preview-box";
  box.innerHTML=`<div class="preview-name">From: ${msg.name}</div>`;
  if(msg.photos){
    msg.photos.forEach(p=>{
      const im=document.createElement("img");im.src=p;box.appendChild(im);
    });
  }
  const t=document.createElement("div");t.className="message-text-preview";t.textContent=msg.message;box.appendChild(t);

  // âœ… Add timestamp display
  const timeDiv=document.createElement("div");
  const time=new Date(msg.timestamp);
  timeDiv.className="timestamp";
  timeDiv.textContent=`Submitted on: ${time.toLocaleString()}`;
  box.appendChild(timeDiv);

  const del=document.createElement("button");del.className="delete-btn";del.textContent="Delete";
  del.onclick=async()=>{
    if(confirm("Delete this message?")){
      await db.ref("messages/"+key).remove();
      messagesArray.splice(currentMessageIndex,1);
      if(currentMessageIndex>=messagesArray.length) currentMessageIndex=0;
      showAdminMessage();
    }
  };
  box.appendChild(del);
  g.appendChild(box);
}

// Admin navigation arrows
document.getElementById("adminLeft").onclick=()=>{
  if(messagesArray.length<=1) return;
  currentMessageIndex=(currentMessageIndex-1+messagesArray.length)%messagesArray.length;
  showAdminMessage();
};
document.getElementById("adminRight").onclick=()=>{
  if(messagesArray.length<=1) return;
  currentMessageIndex=(currentMessageIndex+1)%messagesArray.length;
  showAdminMessage();
};

// Back
document.getElementById("backBtn").onclick=()=>showSection("nameSection");
</script>
</body>
</html>
